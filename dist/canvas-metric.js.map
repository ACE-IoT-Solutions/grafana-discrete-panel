{"version":3,"sources":["../src/canvas-metric.js"],"names":["MetricsPanelCtrl","_","moment","angular","appEvents","CanvasPanelCtrl","$scope","$injector","$q","q","data","mouse","position","down","$tooltip","$","events","on","onPanelInitalized","bind","onRefresh","onRender","console","log","render","context","rect","wrap","getBoundingClientRect","height","Math","max","width","canvas","centerV","ctx","lineWidth","textBaseline","time","dashboard","formatDate","ts","fillStyle","fillRect","font","textAlign","fillText","xmin","min","x","xmax","globalCompositeOperation","beginPath","fill","strokeStyle","moveTo","lineTo","stroke","detach","evt","elapsed","range","to","from","offsetX","parseFloat","y","clientY","top","yRel","showTT","isExternal","where","scope","elem","attrs","ctrl","find","document","createElement","appendChild","css","getContext","addEventListener","getMousePosition","info","pos","pageX","pageY","panelRelY","panel","emit","up","onMouseClicked","utc","onMouseSelectedRange","event","isThis","id","sharedTooltipModeEnabled","otherPanelInFullscreenMode","onGraphHover","sharedCrosshairModeOnly"],"mappings":"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","file":"canvas-metric.js","sourcesContent":["\r\nimport {MetricsPanelCtrl} from  'app/plugins/sdk';\r\n\r\nimport _ from 'lodash';\r\nimport moment from 'moment';\r\nimport angular from 'angular';\r\n\r\nimport appEvents from 'app/core/app_events';\r\n\r\n// Expects a template with:\r\n// <div class=\"canvas-spot\"></div>\r\nexport class CanvasPanelCtrl extends MetricsPanelCtrl {\r\n\r\n  constructor($scope, $injector, $q) {\r\n    super($scope, $injector);\r\n\r\n    this.q = $q;\r\n    this.data = null;\r\n    this.mouse = {\r\n      position: null,\r\n      down: null,\r\n    };\r\n    this.$tooltip = $('<div id=\"tooltip\" class=\"graph-tooltip\">');\r\n\r\n    this.events.on('panel-initialized', this.onPanelInitalized.bind(this));\r\n    this.events.on('refresh', this.onRefresh.bind(this));\r\n    this.events.on('render', this.onRender.bind(this));\r\n\r\n    console.log( 'constructor', this );\r\n  }\r\n\r\n  onPanelInitalized() {\r\n    console.log(\"onPanelInitalized()\");\r\n    this.render();\r\n  }\r\n\r\n  onRefresh() {\r\n    console.log(\"onRefresh()\");\r\n    this.render();\r\n  }\r\n\r\n  // Typically you will override this\r\n  onRender() {\r\n    if( !(this.context) ) {\r\n      console.log( 'No context!');\r\n      return;\r\n    }\r\n    console.log( 'canvas render', this.mouse );\r\n\r\n    var rect = this.wrap.getBoundingClientRect();\r\n\r\n\r\n    var height = Math.max( this.height, 100 );\r\n    var width = rect.width;\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n\r\n    var centerV = height / 2;\r\n\r\n    var ctx = this.context;\r\n    ctx.lineWidth = 1;\r\n    ctx.textBaseline = 'middle';\r\n\r\n    var time = \"\";\r\n    if(this.mouse.position != null) {\r\n      time = this.dashboard.formatDate( moment(this.mouse.position.ts) );\r\n    }\r\n\r\n    ctx.fillStyle = '#999999';\r\n    ctx.fillRect(0, 0, width, height);\r\n    ctx.fillStyle = \"#111111\";\r\n    ctx.font = '24px \"Open Sans\", Helvetica, Arial, sans-serif';\r\n    ctx.textAlign = 'left';\r\n    ctx.fillText(\"Mouse @ \"+time, 10, centerV);\r\n\r\n\r\n\r\n    if(this.mouse.position != null ) {\r\n      if(this.mouse.down != null) {\r\n        var xmin = Math.min( this.mouse.position.x, this.mouse.down.x);\r\n        var xmax = Math.max( this.mouse.position.x, this.mouse.down.x);\r\n\r\n        // Fill canvas using 'destination-out' and alpha at 0.05\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n        ctx.fillStyle = \"rgba(255, 255, 255, 0.6)\";\r\n        ctx.beginPath();\r\n        ctx.fillRect(0, 0, xmin, height);\r\n        ctx.fill();\r\n\r\n        ctx.beginPath();\r\n        ctx.fillRect(xmax, 0, width, height);\r\n        ctx.fill();\r\n        ctx.globalCompositeOperation = 'source-over';\r\n      }\r\n      else {\r\n        ctx.strokeStyle = '#111';\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.mouse.position.x, 0);\r\n        ctx.lineTo(this.mouse.position.x, height);\r\n        ctx.lineWidth = 3;\r\n        ctx.stroke();\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.mouse.position.x, 0);\r\n        ctx.lineTo(this.mouse.position.x, height);\r\n        ctx.strokeStyle = '#e22c14';\r\n        ctx.lineWidth = 2;\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n\r\n  clearTT() {\r\n    this.$tooltip.detach();\r\n  }\r\n\r\n  getMousePosition(evt) {\r\n    var elapsed = this.range.to - this.range.from;\r\n    var rect = this.canvas.getBoundingClientRect();\r\n    var x = evt.offsetX; // - rect.left;\r\n    var ts = this.range.from + (elapsed*(x/parseFloat(rect.width)));\r\n    var y = evt.clientY - rect.top;\r\n\r\n    return {\r\n      x: x,\r\n      y: y,\r\n      yRel: y / parseFloat(rect.height),\r\n      ts: ts,\r\n      evt: evt\r\n    };\r\n  }\r\n\r\n  onGraphHover(evt, showTT, isExternal) {\r\n    console.log( \"HOVER\", evt, showTT, isExternal );\r\n  }\r\n\r\n  onMouseClicked(where) {\r\n    console.log( \"CANVAS CLICKED\", where );\r\n    this.render();\r\n  }\r\n\r\n  onMouseSelectedRange(range) {\r\n    console.log( \"CANVAS Range\", range );\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    this.wrap = elem.find('.canvas-spot')[0];\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.wrap.appendChild(this.canvas);\r\n\r\n    $(this.canvas).css( 'cursor', 'pointer' );\r\n    $(this.wrap).css( 'width', '100%' );\r\n\r\n  //  console.log( 'link', this );\r\n\r\n    this.context = this.canvas.getContext('2d');\r\n    this.canvas.addEventListener('mousemove', (evt) => {\r\n      this.mouse.position = this.getMousePosition(evt);\r\n      var info = {\r\n        pos: {\r\n          pageX: evt.pageX,\r\n          pageY: evt.pageY,\r\n          x: this.mouse.position.ts,\r\n          y: this.mouse.position.y,\r\n          panelRelY: this.mouse.position.yRel\r\n        },\r\n        panel: this.panel\r\n      }\r\n      appEvents.emit('graph-hover', info);\r\n      if(this.mouse.down != null) {\r\n        $(this.canvas).css( 'cursor', 'col-resize' );\r\n      }\r\n    }, false);\r\n\r\n    this.canvas.addEventListener('mouseout', (evt) => {\r\n      this.mouse.position = null;\r\n      this.mouse.down = null;\r\n      this.onRender();\r\n      this.$tooltip.detach();\r\n      appEvents.emit('graph-hover-clear');\r\n    }, false);\r\n\r\n    this.canvas.addEventListener('mousedown', (evt) => {\r\n      this.mouse.down = this.getMousePosition(evt);\r\n    }, false);\r\n\r\n    this.canvas.addEventListener('mouseenter', (evt) => {\r\n      $(this.canvas).css( 'cursor', 'pointer' );\r\n    }, false);\r\n\r\n    this.canvas.addEventListener('mouseup', (evt) => {\r\n      this.$tooltip.detach();\r\n      var up = this.getMousePosition(evt);\r\n      if(this.mouse.down != null) {\r\n        if(up.x == this.mouse.down.x && up.y == this.mouse.down.y ) {\r\n          this.mouse.position = null;\r\n          this.mouse.down = null;\r\n          this.onMouseClicked(up);\r\n        }\r\n        else {\r\n          var min = Math.min(this.mouse.down.ts, up.ts);\r\n          var max = Math.max(this.mouse.down.ts, up.ts);\r\n          var range = {from: moment.utc(min), to: moment.utc(max) };\r\n          this.mouse.position = up;\r\n          this.onMouseSelectedRange(range);\r\n        }\r\n      }\r\n      this.mouse.down = null;\r\n      this.mouse.position = null;\r\n    }, false);\r\n\r\n\r\n    // global events\r\n    appEvents.on('graph-hover', (event) => {\r\n\r\n      // ignore other graph hover events if shared tooltip is disabled\r\n      var isThis = event.panel.id === this.panel.id;\r\n      if (!this.dashboard.sharedTooltipModeEnabled() && !isThis) {\r\n        return;\r\n      }\r\n\r\n      // ignore if other panels are fullscreen\r\n      if (this.otherPanelInFullscreenMode()) {\r\n        return;\r\n      }\r\n\r\n      // Calculate the mouse position when it came from somewhere else\r\n      if(!isThis) {\r\n        if(!event.pos.x) {\r\n          console.log( \"Invalid hover point\", event );\r\n          return;\r\n        }\r\n\r\n        var ts = event.pos.x;\r\n        var rect = this.canvas.getBoundingClientRect();\r\n        var elapsed = parseFloat(this.range.to - this.range.from);\r\n        var x = ((ts - this.range.from)/elapsed)*rect.width;\r\n\r\n        this.mouse.position = {\r\n          x: x,\r\n          y: event.pos.panelRelY * rect.height,\r\n          yRel: event.pos.panelRelY,\r\n          ts: ts,\r\n          evt: event\r\n        };\r\n\r\n        //console.log( \"Calculate mouseInfo\", event, this.mouse.position);\r\n      }\r\n\r\n      this.onGraphHover(event, isThis || !this.dashboard.sharedCrosshairModeOnly(), !isThis);\r\n    }, scope);\r\n\r\n    appEvents.on('graph-hover-clear', (event, info) => {\r\n      console.log( \"HOVER Clear\", event);\r\n      this.mouse.position = null;\r\n      this.render();\r\n      this.$tooltip.detach();\r\n    }, scope);\r\n  }\r\n}\r\n\r\n"]}