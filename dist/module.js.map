{"version":3,"sources":["../src/module.js"],"names":["config","CanvasPanelCtrl","DistinctPoints","_","moment","angular","kbn","appEvents","DiscretePanelCtrl","$scope","$injector","$q","data","panelDefaults","rowHeight","valueMaps","value","op","text","mappingTypes","name","rangeMaps","from","to","colorMaps","color","metricNameColor","valueTextColor","backgroundColor","lineColor","textSize","writeLastValue","writeAllValues","writeMetricNames","showLegend","showLegendNames","showLegendPercent","highlightOnMouseover","defaults","panel","externalPT","events","on","onInitEditMode","bind","onRender","onDataReceived","onDataError","onRefresh","updateColorInfo","err","console","log","addEditorTab","editorTabIndex","refresh","context","rect","wrap","getBoundingClientRect","rows","length","height","width","canvas","ctx","lineWidth","textBaseline","font","top","elapsed","range","forEach","metric","centerV","fillStyle","fillRect","lastBS","point","changes","i","start","xt","Math","max","x","getColor","val","textAlign","fillText","strokeStyle","beginPath","moveTo","lineTo","stroke","mouse","position","down","next","ts","globalCompositeOperation","fill","xmin","min","xmax","arc","y","PI","pos","info","body","count","duration","ms","humanize","$tooltip","html","place_tt","pageX","pageY","detach","stats","isNumber","map","parseFloat","isNull","isNil","isString","toString","has","colorMap","palet","abs","hashCode","letters","split","floor","random","str","hash","char","charCodeAt","dataList","$","css","type","columns","last","res","j","row","add","formatValue","finish","push","target","datapoints","index","indexOf","splice","cm","m","render","what","legendInfo","randomColor","rangeMap","disp","dec","legendPercentDecimals","per","valueFormats","percentunit","evt","time","dashboard","formatDate","panelRelY","showTT","isExternal","hover","hoverPoint","showTooltip","where","pt","utc","timeSrv","setTime","clear","emit","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import config from 'app/core/config';\n\nimport {CanvasPanelCtrl} from './canvas-metric';\nimport DistinctPoints from './points';\n\nimport _ from 'lodash';\nimport moment from 'moment';\nimport angular from 'angular';\nimport kbn from 'app/core/utils/kbn';\n\nimport appEvents from 'app/core/app_events';\n\nclass DiscretePanelCtrl extends CanvasPanelCtrl {\n\n  constructor($scope, $injector, $q) {\n    super($scope, $injector, $q);\n\n    this.data = null;\n\n    // Set and populate defaults\n    var panelDefaults = {\n      rowHeight: 50,\n      valueMaps: [\n        { value: 'null', op: '=', text: 'N/A' }\n      ],\n      mappingTypes: [\n        {name: 'value to text', value: 1},\n        {name: 'range to text', value: 2},\n      ],\n      rangeMaps: [\n        { from: 'null', to: 'null', text: 'N/A' }\n      ],\n      colorMaps: [\n        { text: 'N/A', color: '#CCC' }\n      ],\n      metricNameColor: '#000000',\n      valueTextColor: '#000000',\n      backgroundColor: 'rgba(128, 128, 128, 0.1)',\n      lineColor: 'rgba(128, 128, 128, 1.0)',\n      textSize: 24,\n      writeLastValue: true,\n      writeAllValues: false,\n      writeMetricNames: false,\n      showLegend: true,\n      showLegendNames: true,\n      showLegendPercent: true,\n      highlightOnMouseover: true,\n    };\n    _.defaults(this.panel, panelDefaults);\n    this.externalPT = false;\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('refresh', this.onRefresh.bind(this));\n\n    this.updateColorInfo();\n  }\n\n  onDataError(err) {\n    console.log(\"onDataError\", err);\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/natel-discrete-panel/editor.html',1);\n    this.addEditorTab('Colors', 'public/plugins/natel-discrete-panel/colors.html',3);\n    this.addEditorTab('Mappings', 'public/plugins/natel-discrete-panel/mappings.html', 4);\n    this.editorTabIndex = 1;\n    this.refresh();\n  }\n\n  onRender() {\n    if(this.data == null ||  !(this.context) ) {\n      return;\n    }\n\n //   console.log( 'render', this.data);\n\n    var rect = this.wrap.getBoundingClientRect();\n\n    var rows = this.data.length;\n    var rowHeight = this.panel.rowHeight;\n\n    var height = rowHeight * rows;\n    var width = rect.width;\n    this.canvas.width = width;\n    this.canvas.height = height;\n\n    var ctx = this.context;\n    ctx.lineWidth = 1;\n    ctx.textBaseline = 'middle';\n    ctx.font = this.panel.textSize + 'px \"Open Sans\", Helvetica, Arial, sans-serif';\n\n    // ctx.shadowOffsetX = 1;\n    // ctx.shadowOffsetY = 1;\n    // ctx.shadowColor = \"rgba(0,0,0,0.3)\";\n    // ctx.shadowBlur = 3;\n\n    var top = 0;\n\n    var elapsed = this.range.to - this.range.from;\n\n    _.forEach(this.data, (metric) => {\n      var centerV = top + (rowHeight/2);\n\n      // The no-data line\n      ctx.fillStyle = this.panel.backgroundColor;\n      ctx.fillRect(0, top, width, rowHeight);\n\n      /*if(!this.panel.writeMetricNames) {\n        ctx.fillStyle = \"#111111\";\n        ctx.textAlign = 'left';\n        ctx.fillText(\"No Data\", 10, centerV);\n      }*/\n\n      var lastBS = 0;\n      var point = metric.changes[0];\n      for(var i=0; i<metric.changes.length; i++) {\n        point = metric.changes[i];\n        if(point.start <= this.range.to) {\n          var xt = Math.max( point.start - this.range.from, 0 );\n          point.x = (xt / elapsed) * width;\n          ctx.fillStyle = this.getColor( point.val );\n          ctx.fillRect(point.x, top, width, rowHeight);\n\n          if(this.panel.writeAllValues) {\n            ctx.fillStyle = this.panel.valueTextColor;\n            ctx.textAlign = 'left';\n            ctx.fillText(point.val, point.x+7, centerV);\n          }\n          lastBS = point.x;\n        }\n      }\n\n\n\n      if(top>0) {\n        ctx.strokeStyle = this.panel.lineColor;\n        ctx.beginPath();\n        ctx.moveTo(0, top);\n        ctx.lineTo(width, top);\n        ctx.stroke();\n      }\n\n      ctx.fillStyle = \"#000000\";\n\n      if(this.panel.writeMetricNames && (!this.panel.highlightOnMouseover || (this.panel.highlightOnMouseover && (this.mouse.position==null || this.mouse.position.x > 200 ) ) ) ) {\n        ctx.fillStyle = this.panel.metricNameColor;\n        ctx.textAlign = 'left';\n        ctx.fillText( metric.name, 10, centerV);\n      }\n\n      ctx.textAlign = 'right';\n\n      if( this.mouse.down == null ) {\n        if( this.panel.highlightOnMouseover && this.mouse.position != null ) {\n          point = metric.changes[0];\n          var next = null;\n          for(var i=0; i<metric.changes.length; i++) {\n            if(metric.changes[i].start > this.mouse.position.ts) {\n              next = metric.changes[i];\n              break;\n            }\n            point = metric.changes[i];\n          }\n\n          // Fill canvas using 'destination-out' and alpha at 0.05\n          ctx.globalCompositeOperation = 'destination-out';\n          ctx.fillStyle = \"rgba(255, 255, 255, 0.5)\";\n          ctx.beginPath();\n          ctx.fillRect(0, top, point.x, rowHeight);\n          ctx.fill();\n\n          if(next != null) {\n            ctx.beginPath();\n            ctx.fillRect(next.x, top, width, rowHeight);\n            ctx.fill();\n          }\n          ctx.globalCompositeOperation = 'source-over';\n\n          // Now Draw the value\n          ctx.fillStyle = \"#000000\";\n          ctx.textAlign = 'left';\n          ctx.fillText( point.val, point.x+7, centerV);\n        }\n        else if( this.panel.writeLastValue ) {\n          ctx.fillText( point.val, width-7, centerV );\n        }\n      }\n\n      top += rowHeight;\n    });\n\n\n    if(this.mouse.position != null ) {\n      if(this.mouse.down != null) {\n        var xmin = Math.min( this.mouse.position.x, this.mouse.down.x);\n        var xmax = Math.max( this.mouse.position.x, this.mouse.down.x);\n\n        // Fill canvas using 'destination-out' and alpha at 0.05\n        ctx.globalCompositeOperation = 'destination-out';\n        ctx.fillStyle = \"rgba(255, 255, 255, 0.6)\";\n        ctx.beginPath();\n        ctx.fillRect(0, 0, xmin, height);\n        ctx.fill();\n\n        ctx.beginPath();\n        ctx.fillRect(xmax, 0, width, height);\n        ctx.fill();\n        ctx.globalCompositeOperation = 'source-over';\n      }\n      else {\n        ctx.strokeStyle = '#111';\n        ctx.beginPath();\n        ctx.moveTo(this.mouse.position.x, 0);\n        ctx.lineTo(this.mouse.position.x, height);\n        ctx.lineWidth = 3;\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.moveTo(this.mouse.position.x, 0);\n        ctx.lineTo(this.mouse.position.x, height);\n        ctx.strokeStyle = '#e22c14';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        if(this.externalPT && rows>1) {\n          ctx.beginPath();\n          ctx.arc(this.mouse.position.x, this.mouse.position.y, 3, 0, 2 * Math.PI, false);\n          ctx.fillStyle = '#e22c14';\n          ctx.fill();\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = '#111';\n          ctx.stroke();\n        }\n      }\n    }\n  }\n\n\n  showLegandTooltip(pos, info) {\n    var body = '<div class=\"graph-tooltip-time\">'+ info.val +'</div>';\n\n    body += \"<center>\";\n    if(info.count > 1) {\n      body += info.count + \" times<br/>for<br/>\";\n    }\n    body += moment.duration(info.ms).humanize();\n    if(info.count > 1) {\n      body += \"<br/>total\";\n    }\n    body += \"</center>\"\n\n    this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  }\n\n  clearTT() {\n    this.$tooltip.detach();\n  }\n\n  formatValue(val, stats) {\n\n    if(_.isNumber(val) && this.panel.rangeMaps) {\n      for (var i = 0; i < this.panel.rangeMaps.length; i++) {\n        var map = this.panel.rangeMaps[i];\n\n        // value/number to range mapping\n        var from = parseFloat(map.from);\n        var to = parseFloat(map.to);\n        if (to >= val && from <= val) {\n          return map.text;\n        }\n      }\n    }\n\n    var isNull = _.isNil(val);\n    if(!isNull && !_.isString(val)) {\n      val = val.toString(); // convert everything to a string\n    }\n\n    for (var i = 0; i < this.panel.valueMaps.length; i++) {\n      var map = this.panel.valueMaps[i];\n      // special null case\n      if (map.value === 'null') {\n        if (isNull) {\n          return map.text;\n        }\n        continue;\n      }\n\n      if(val == map.value) {\n        return map.text;\n      }\n    }\n\n    if(isNull) {\n      return \"null\";\n    }\n    return val;\n  }\n\n  getColor(val) {\n    if(_.has(this.colorMap, val)) {\n      return this.colorMap[val];\n    }\n\n    var palet = [\n      '#FF4444',\n      '#9933CC',\n      '#32D1DF',\n      '#ed2e18',\n      '#CC3900',\n      '#F79520',\n      '#33B5E5'\n    ];\n\n    return palet[ Math.abs(this.hashCode(val+'')) % palet.length ];\n  }\n\n  randomColor() {\n    var letters = 'ABCDE'.split('');\n    var color = '#';\n    for (var i=0; i<3; i++ ) {\n        color += letters[Math.floor(Math.random() * letters.length)];\n    }\n    return color;\n  }\n\n  hashCode(str){\n    var hash = 0;\n    if (str.length == 0) return hash;\n    for (var i = 0; i < str.length; i++) {\n      var char = str.charCodeAt(i);\n      hash = ((hash<<5)-hash)+char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n  }\n\n  //-----------\n\n  onDataReceived(dataList) {\n    $(this.canvas).css( 'cursor', 'pointer' );\n\n//    console.log('GOT', dataList);\n\n    var data = [];\n    _.forEach(dataList, (metric) => {\n      if('table'=== metric.type) {\n        if('time' != metric.columns[0].type) {\n          throw 'Expected a time column from the table format';\n        }\n\n        var last = null;\n        for(var i=1; i<metric.columns.length; i++) {\n          var res = new DistinctPoints(metric.columns[i].text);\n          for(var j=0; j<metric.rows.length; j++) {\n            var row = metric.rows[j];\n            res.add( row[0], this.formatValue( row[i] ) );\n          }\n          res.finish( this );\n          data.push( res );\n        }\n      }\n      else {\n        var res = new DistinctPoints( metric.target );\n        _.forEach(metric.datapoints, (point) => {\n          res.add( point[1], this.formatValue(point[0]) );\n        });\n        res.finish( this );\n        data.push( res );\n      }\n    });\n    this.data = data;\n\n    this.onRender();\n\n    //console.log( 'data', dataList, this.data);\n  }\n\n  removeColorMap(map) {\n    var index = _.indexOf(this.panel.colorMaps, map);\n    this.panel.colorMaps.splice(index, 1);\n    this.updateColorInfo();\n  };\n\n  updateColorInfo() {\n    var cm = {};\n    for(var i=0; i<this.panel.colorMaps.length; i++) {\n      var m = this.panel.colorMaps[i];\n      if(m.text) {\n        cm[m.text] = m.color;\n      }\n    }\n    this.colorMap = cm;\n    this.render();\n  }\n\n  addColorMap(what) {\n    if(what == 'curent') {\n      _.forEach(this.data, (metric) => {\n        if(metric.legendInfo) {\n          _.forEach(metric.legendInfo, (info) => {\n            if(!_.has(info.val)) {\n              this.panel.colorMaps.push({text: info.val, color: this.getColor(info.val) });\n            }\n          });\n        }\n      });\n    }\n    else {\n      this.panel.colorMaps.push({text: '???', color: this.randomColor() });\n    }\n    this.updateColorInfo();\n  }\n\n  removeValueMap(map) {\n    var index = _.indexOf(this.panel.valueMaps, map);\n    this.panel.valueMaps.splice(index, 1);\n    this.render();\n  };\n\n  addValueMap() {\n    this.panel.valueMaps.push({value: '', op: '=', text: '' });\n  }\n\n  removeRangeMap(rangeMap) {\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n    this.panel.rangeMaps.splice(index, 1);\n    this.render();\n  };\n\n  addRangeMap() {\n    this.panel.rangeMaps.push({from: '', to: '', text: ''});\n  }\n\n  onConfigChanged() {\n    //console.log( \"Config changed...\");\n    this.render();\n  }\n\n  getLegendDisplay(info, metric) {\n    var disp = info.val;\n    if(this.panel.showLegendPercent) {\n      var dec = this.panel.legendPercentDecimals;\n      if(_.isNil(dec)) {\n        if(info.per>.99 && metric.changes.length>1) {\n          dec = 2;\n        }\n        else if(info.per<0.01) {\n          dec = 2;\n        }\n        else {\n          dec = 0;\n        }\n      }\n      return disp + \" (\"+kbn.valueFormats.percentunit(info.per, dec)+\")\";\n    }\n    return disp;\n  }\n\n  //------------------\n  // Mouse Events\n  //------------------\n\n  showTooltip(evt, point) {\n    var from = point.start;\n    var to = point.start + point.ms;\n    var time = point.ms;\n    var val = point.val;\n\n    if(this.mouse.down != null) {\n      from = Math.min(this.mouse.down.ts, this.mouse.position.ts);\n      to   = Math.max(this.mouse.down.ts, this.mouse.position.ts);\n      time = to - from;\n      val = \"Zoom To:\";\n    }\n\n    var body = '<div class=\"graph-tooltip-time\">'+ val + '</div>';\n\n    body += \"<center>\"\n    body += this.dashboard.formatDate( moment(from) ) + \"<br/>\";\n    body += \"to<br/>\";\n    body += this.dashboard.formatDate( moment(to) ) + \"<br/><br/>\";\n    body += moment.duration(time).humanize() + \"<br/>\";\n    body += \"</center>\"\n\n    var rect = this.canvas.getBoundingClientRect();\n    var pageY = rect.top + (evt.pos.panelRelY * rect.height);\n\n    this.$tooltip.html(body).place_tt(evt.pos.pageX + 20, pageY);\n  };\n\n  onGraphHover(evt, showTT, isExternal) {\n    this.externalPT = false;\n    if(this.data) {\n      var hover = null;\n      var j = Math.floor(this.mouse.position.y/this.panel.rowHeight);\n      if (j < 0) {\n        j = 0;\n      }\n      if (j >= this.data.length) {\n        j = this.data.length-1;\n      }\n      hover = this.data[j].changes[0];\n      for(var i=0; i<this.data[j].changes.length; i++) {\n        if(this.data[j].changes[i].start > this.mouse.position.ts) {\n          break;\n        }\n        hover = this.data[j].changes[i];\n      }\n      this.hoverPoint = hover;\n\n      if(showTT) {\n        this.showTooltip( evt, hover );\n        this.externalPT = isExternal;\n      }\n      this.onRender(); // refresh the view\n    }\n    else {\n      this.$tooltip.detach(); // make sure it is hidden\n    }\n  }\n\n  onMouseClicked(where) {\n    var pt = this.hoverPoint;\n    var range = {from: moment.utc(pt.start), to: moment.utc(pt.start+pt.ms) };\n    this.timeSrv.setTime(range);\n    this.clear();\n  }\n\n  onMouseSelectedRange(range) {\n    this.timeSrv.setTime(range);\n    this.clear();\n  }\n\n  clear() {\n    this.mouse.position = null;\n    this.mouse.down = null;\n    this.hoverPoint = null;\n    $(this.canvas).css( 'cursor', 'wait' );\n    appEvents.emit('graph-hover-clear');\n    this.render();\n  }\n}\nDiscretePanelCtrl.templateUrl = 'module.html';\n\nexport {\n  DiscretePanelCtrl as PanelCtrl\n};\n\n\n"]}