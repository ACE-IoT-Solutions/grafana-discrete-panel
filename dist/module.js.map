{"version":3,"sources":["../src/module.js"],"names":["config","CanvasPanelCtrl","DistinctPoints","_","moment","angular","kbn","appEvents","DiscretePanelCtrl","$scope","$injector","$q","data","panelDefaults","display","rowHeight","valueMaps","value","op","text","mappingTypes","name","rangeMaps","from","to","colorMaps","color","metricNameColor","valueTextColor","backgroundColor","lineColor","textSize","extendLastValue","writeLastValue","writeAllValues","writeMetricNames","showLegend","showLegendNames","showLegendValues","showLegendPercent","highlightOnMouseover","legendSortBy","defaults","panel","externalPT","events","on","onInitEditMode","bind","onRender","onDataReceived","onDataError","onRefresh","updateColorInfo","onConfigChanged","err","console","log","addEditorTab","editorTabIndex","refresh","context","rect","wrap","getBoundingClientRect","rows","length","height","width","canvas","ctx","lineWidth","textBaseline","font","top","elapsed","range","forEach","metric","centerV","fillStyle","fillRect","isTimeline","lastBS","point","changes","i","start","xt","Math","max","x","getColor","val","textAlign","fillText","legendInfo","ms","strokeStyle","beginPath","moveTo","lineTo","stroke","mouse","position","down","next","ts","globalCompositeOperation","fill","xmin","min","xmax","arc","y","PI","pos","info","body","count","duration","humanize","$tooltip","html","place_tt","pageX","pageY","detach","stats","isNumber","map","parseFloat","isNull","isNil","isString","toString","has","colorMap","palet","abs","hashCode","letters","split","floor","random","str","hash","char","charCodeAt","datasource","targets","when","scopedVars","Object","assign","interval","intervalMs","rangeRaw","raw","expandFromQueryS","clone","subtract","format","metricsQuery","panelId","id","renderer","maxDataPoints","resolution","cacheTimeout","query","dataList","$","css","type","columns","last","res","j","row","add","formatValue","finish","push","target","datapoints","index","indexOf","splice","cm","m","render","what","randomColor","rangeMap","disp","showLegendCounts","showLegendTime","hassomething","dec","legendPercentDecimals","per","valueFormats","percentunit","evt","isExternal","time","dashboard","formatDate","panelRelY","window","innerHeight","scrollTop","pX","left","showTT","hover","hoverPoint","showTooltip","showLegandTooltip","where","pt","utc","timeSrv","setTime","clear","emit","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import config from 'app/core/config';\r\n\r\nimport {CanvasPanelCtrl} from './canvas-metric';\r\nimport DistinctPoints from './points';\r\n\r\nimport _ from 'lodash';\r\nimport moment from 'moment';\r\nimport angular from 'angular';\r\nimport kbn from 'app/core/utils/kbn';\r\n\r\nimport appEvents from 'app/core/app_events';\r\n\r\nclass DiscretePanelCtrl extends CanvasPanelCtrl {\r\n\r\n  constructor($scope, $injector, $q) {\r\n    super($scope, $injector, $q);\r\n\r\n    this.data = null;\r\n\r\n    // Set and populate defaults\r\n    var panelDefaults = {\r\n      display: 'timeline',\r\n      rowHeight: 50,\r\n      valueMaps: [\r\n        { value: 'null', op: '=', text: 'N/A' }\r\n      ],\r\n      mappingTypes: [\r\n        {name: 'value to text', value: 1},\r\n        {name: 'range to text', value: 2},\r\n      ],\r\n      rangeMaps: [\r\n        { from: 'null', to: 'null', text: 'N/A' }\r\n      ],\r\n      colorMaps: [\r\n        { text: 'N/A', color: '#CCC' }\r\n      ],\r\n      metricNameColor: '#000000',\r\n      valueTextColor: '#000000',\r\n      backgroundColor: 'rgba(128, 128, 128, 0.1)',\r\n      lineColor: 'rgba(128, 128, 128, 1.0)',\r\n      textSize: 24,\r\n      extendLastValue: true,\r\n      writeLastValue: true,\r\n      writeAllValues: false,\r\n      writeMetricNames: false,\r\n      showLegend: true,\r\n      showLegendNames: true,\r\n      showLegendValues: true,\r\n      showLegendPercent: true,\r\n      highlightOnMouseover: true,\r\n      legendSortBy: '-ms'\r\n    };\r\n    _.defaults(this.panel, panelDefaults);\r\n    this.externalPT = false;\r\n\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('render', this.onRender.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('refresh', this.onRefresh.bind(this));\r\n\r\n    this.updateColorInfo();\r\n    this.onConfigChanged();\r\n  }\r\n\r\n  onDataError(err) {\r\n    console.log(\"onDataError\", err);\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/plugins/natel-discrete-panel/editor.html',1);\r\n    this.addEditorTab('Legend', 'public/plugins/natel-discrete-panel/legend.html',3);\r\n    this.addEditorTab('Colors', 'public/plugins/natel-discrete-panel/colors.html',4);\r\n    this.addEditorTab('Mappings', 'public/plugins/natel-discrete-panel/mappings.html', 5);\r\n    this.editorTabIndex = 1;\r\n    this.refresh();\r\n  }\r\n\r\n  onRender() {\r\n    if(this.data == null ||  !(this.context) ) {\r\n      return;\r\n    }\r\n\r\n //   console.log( 'render', this.data);\r\n\r\n    var rect = this.wrap.getBoundingClientRect();\r\n\r\n    var rows = this.data.length;\r\n    var rowHeight = this.panel.rowHeight;\r\n\r\n    var height = rowHeight * rows;\r\n    var width = rect.width;\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n\r\n    var ctx = this.context;\r\n    ctx.lineWidth = 1;\r\n    ctx.textBaseline = 'middle';\r\n    ctx.font = this.panel.textSize + 'px \"Open Sans\", Helvetica, Arial, sans-serif';\r\n\r\n    // ctx.shadowOffsetX = 1;\r\n    // ctx.shadowOffsetY = 1;\r\n    // ctx.shadowColor = \"rgba(0,0,0,0.3)\";\r\n    // ctx.shadowBlur = 3;\r\n\r\n    var top = 0;\r\n\r\n    var elapsed = this.range.to - this.range.from;\r\n\r\n    _.forEach(this.data, (metric) => {\r\n      var centerV = top + (rowHeight/2);\r\n\r\n      // The no-data line\r\n      ctx.fillStyle = this.panel.backgroundColor;\r\n      ctx.fillRect(0, top, width, rowHeight);\r\n\r\n      /*if(!this.panel.writeMetricNames) {\r\n        ctx.fillStyle = \"#111111\";\r\n        ctx.textAlign = 'left';\r\n        ctx.fillText(\"No Data\", 10, centerV);\r\n      }*/\r\n      if(this.isTimeline) {\r\n        var lastBS = 0;\r\n        var point = metric.changes[0];\r\n        for(var i=0; i<metric.changes.length; i++) {\r\n          point = metric.changes[i];\r\n          if(point.start <= this.range.to) {\r\n            var xt = Math.max( point.start - this.range.from, 0 );\r\n            point.x = (xt / elapsed) * width;\r\n            ctx.fillStyle = this.getColor( point.val );\r\n            ctx.fillRect(point.x, top, width, rowHeight);\r\n\r\n            if(this.panel.writeAllValues) {\r\n              ctx.fillStyle = this.panel.valueTextColor;\r\n              ctx.textAlign = 'left';\r\n              ctx.fillText(point.val, point.x+7, centerV);\r\n            }\r\n            lastBS = point.x;\r\n          }\r\n        }\r\n      }\r\n      else if(this.panel.display == 'stacked') {\r\n        var point = null;\r\n        var start = this.range.from;\r\n        for(var i=0; i<metric.legendInfo.length; i++) {\r\n          point = metric.legendInfo[i];\r\n\r\n          var xt = Math.max( start - this.range.from, 0 );\r\n          point.x = (xt / elapsed) * width;\r\n          ctx.fillStyle = this.getColor( point.val );\r\n          ctx.fillRect(point.x, top, width, rowHeight);\r\n\r\n          if(this.panel.writeAllValues) {\r\n            ctx.fillStyle = this.panel.valueTextColor;\r\n            ctx.textAlign = 'left';\r\n            ctx.fillText(point.val, point.x+7, centerV);\r\n          }\r\n\r\n          start += point.ms;\r\n        }\r\n      }\r\n      else {\r\n        console.log( \"Not supported yet...\", this );\r\n      }\r\n\r\n      if(top>0) {\r\n        ctx.strokeStyle = this.panel.lineColor;\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, top);\r\n        ctx.lineTo(width, top);\r\n        ctx.stroke();\r\n      }\r\n\r\n      ctx.fillStyle = \"#000000\";\r\n\r\n      if( this.panel.writeMetricNames &&\r\n          this.mouse.position == null &&\r\n        (!this.panel.highlightOnMouseover || this.panel.highlightOnMouseover )\r\n      ) {\r\n        ctx.fillStyle = this.panel.metricNameColor;\r\n        ctx.textAlign = 'left';\r\n        ctx.fillText( metric.name, 10, centerV);\r\n      }\r\n\r\n      ctx.textAlign = 'right';\r\n\r\n      if( this.mouse.down == null ) {\r\n        if( this.panel.highlightOnMouseover && this.mouse.position != null ) {\r\n          var next = null;\r\n\r\n          if(this.isTimeline) {\r\n            point = metric.changes[0];\r\n            for(var i=0; i<metric.changes.length; i++) {\r\n              if(metric.changes[i].start > this.mouse.position.ts) {\r\n                next = metric.changes[i];\r\n                break;\r\n              }\r\n              point = metric.changes[i];\r\n            }\r\n          }\r\n          else if(this.panel.display == 'stacked') {\r\n            point = metric.legendInfo[0];\r\n            for(var i=0; i<metric.legendInfo.length; i++) {\r\n              if(metric.legendInfo[i].x > this.mouse.position.x) {\r\n                next = metric.legendInfo[i];\r\n                break;\r\n              }\r\n              point = metric.legendInfo[i];\r\n            }\r\n          }\r\n\r\n          // Fill canvas using 'destination-out' and alpha at 0.05\r\n          ctx.globalCompositeOperation = 'destination-out';\r\n          ctx.fillStyle = \"rgba(255, 255, 255, 0.5)\";\r\n          ctx.beginPath();\r\n          ctx.fillRect(0, top, point.x, rowHeight);\r\n          ctx.fill();\r\n\r\n          if(next != null) {\r\n            ctx.beginPath();\r\n            ctx.fillRect(next.x, top, width, rowHeight);\r\n            ctx.fill();\r\n          }\r\n          ctx.globalCompositeOperation = 'source-over';\r\n\r\n          // Now Draw the value\r\n          ctx.fillStyle = \"#000000\";\r\n          ctx.textAlign = 'left';\r\n          ctx.fillText( point.val, point.x+7, centerV);\r\n        }\r\n        else if( this.panel.writeLastValue ) {\r\n          ctx.fillText( point.val, width-7, centerV );\r\n        }\r\n      }\r\n\r\n      top += rowHeight;\r\n    });\r\n\r\n\r\n\r\n    if( this.isTimeline && this.mouse.position != null ) {\r\n      if(this.mouse.down != null) {\r\n        var xmin = Math.min( this.mouse.position.x, this.mouse.down.x);\r\n        var xmax = Math.max( this.mouse.position.x, this.mouse.down.x);\r\n\r\n        // Fill canvas using 'destination-out' and alpha at 0.05\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n        ctx.fillStyle = \"rgba(255, 255, 255, 0.6)\";\r\n        ctx.beginPath();\r\n        ctx.fillRect(0, 0, xmin, height);\r\n        ctx.fill();\r\n\r\n        ctx.beginPath();\r\n        ctx.fillRect(xmax, 0, width, height);\r\n        ctx.fill();\r\n        ctx.globalCompositeOperation = 'source-over';\r\n      }\r\n      else {\r\n        ctx.strokeStyle = '#111';\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.mouse.position.x, 0);\r\n        ctx.lineTo(this.mouse.position.x, height);\r\n        ctx.lineWidth = 3;\r\n        ctx.stroke();\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.mouse.position.x, 0);\r\n        ctx.lineTo(this.mouse.position.x, height);\r\n        ctx.strokeStyle = '#e22c14';\r\n        ctx.lineWidth = 2;\r\n        ctx.stroke();\r\n\r\n        if(this.externalPT && rows>1) {\r\n          ctx.beginPath();\r\n          ctx.arc(this.mouse.position.x, this.mouse.position.y, 3, 0, 2 * Math.PI, false);\r\n          ctx.fillStyle = '#e22c14';\r\n          ctx.fill();\r\n          ctx.lineWidth = 1;\r\n          ctx.strokeStyle = '#111';\r\n          ctx.stroke();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  showLegandTooltip(pos, info) {\r\n    var body = '<div class=\"graph-tooltip-time\">'+ info.val +'</div>';\r\n\r\n    body += \"<center>\";\r\n    if(info.count > 1) {\r\n      body += info.count + \" times<br/>for<br/>\";\r\n    }\r\n    body += moment.duration(info.ms).humanize();\r\n    if(info.count > 1) {\r\n      body += \"<br/>total\";\r\n    }\r\n    body += \"</center>\"\r\n\r\n    this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\r\n  }\r\n\r\n  clearTT() {\r\n    this.$tooltip.detach();\r\n  }\r\n\r\n  formatValue(val, stats) {\r\n\r\n    if(_.isNumber(val) && this.panel.rangeMaps) {\r\n      for (var i = 0; i < this.panel.rangeMaps.length; i++) {\r\n        var map = this.panel.rangeMaps[i];\r\n\r\n        // value/number to range mapping\r\n        var from = parseFloat(map.from);\r\n        var to = parseFloat(map.to);\r\n        if (to >= val && from <= val) {\r\n          return map.text;\r\n        }\r\n      }\r\n    }\r\n\r\n    var isNull = _.isNil(val);\r\n    if(!isNull && !_.isString(val)) {\r\n      val = val.toString(); // convert everything to a string\r\n    }\r\n\r\n    for (var i = 0; i < this.panel.valueMaps.length; i++) {\r\n      var map = this.panel.valueMaps[i];\r\n      // special null case\r\n      if (map.value === 'null') {\r\n        if (isNull) {\r\n          return map.text;\r\n        }\r\n        continue;\r\n      }\r\n\r\n      if(val == map.value) {\r\n        return map.text;\r\n      }\r\n    }\r\n\r\n    if(isNull) {\r\n      return \"null\";\r\n    }\r\n    return val;\r\n  }\r\n\r\n  getColor(val) {\r\n    if(_.has(this.colorMap, val)) {\r\n      return this.colorMap[val];\r\n    }\r\n\r\n    var palet = [\r\n      '#FF4444',\r\n      '#9933CC',\r\n      '#32D1DF',\r\n      '#ed2e18',\r\n      '#CC3900',\r\n      '#F79520',\r\n      '#33B5E5'\r\n    ];\r\n\r\n    return palet[ Math.abs(this.hashCode(val+'')) % palet.length ];\r\n  }\r\n\r\n  randomColor() {\r\n    var letters = 'ABCDE'.split('');\r\n    var color = '#';\r\n    for (var i=0; i<3; i++ ) {\r\n        color += letters[Math.floor(Math.random() * letters.length)];\r\n    }\r\n    return color;\r\n  }\r\n\r\n  hashCode(str){\r\n    var hash = 0;\r\n    if (str.length == 0) return hash;\r\n    for (var i = 0; i < str.length; i++) {\r\n      var char = str.charCodeAt(i);\r\n      hash = ((hash<<5)-hash)+char;\r\n      hash = hash & hash; // Convert to 32bit integer\r\n    }\r\n    return hash;\r\n  }\r\n\r\n  // Copied from Metrics Panel, only used to expand the 'from' query\r\n  issueQueries(datasource) {\r\n    this.datasource = datasource;\r\n\r\n    if (!this.panel.targets || this.panel.targets.length === 0) {\r\n      return this.$q.when([]);\r\n    }\r\n\r\n    // make shallow copy of scoped vars,\r\n    // and add built in variables interval and interval_ms\r\n    var scopedVars = Object.assign({}, this.panel.scopedVars, {\r\n      \"__interval\":     {text: this.interval,   value: this.interval},\r\n      \"__interval_ms\":  {text: this.intervalMs, value: this.intervalMs},\r\n    });\r\n\r\n    var range = this.range;\r\n    var rangeRaw = this.rangeRaw || this.range.raw;\r\n    if(this.panel.expandFromQueryS > 0) {\r\n      range = {\r\n        from: this.range.from.clone(),\r\n        to: this.range.to\r\n      };\r\n      range.from.subtract( this.panel.expandFromQueryS, 's' );\r\n\r\n      rangeRaw = {\r\n        from: range.from.format(),\r\n        to: rangeRaw.to\r\n      };\r\n      range.raw = rangeRaw;\r\n    }\r\n\r\n    var metricsQuery = {\r\n      panelId: this.panel.id,\r\n      range: range,\r\n      rangeRaw: rangeRaw,\r\n      interval: this.interval,\r\n      intervalMs: this.intervalMs,\r\n      targets: this.panel.targets,\r\n      format: this.panel.renderer === 'png' ? 'png' : 'json',\r\n      maxDataPoints: this.resolution,\r\n      scopedVars: scopedVars,\r\n      cacheTimeout: this.panel.cacheTimeout\r\n    };\r\n\r\n    return datasource.query(metricsQuery);\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    $(this.canvas).css( 'cursor', 'pointer' );\r\n\r\n//    console.log('GOT', dataList);\r\n\r\n    var data = [];\r\n    _.forEach(dataList, (metric) => {\r\n      if('table'=== metric.type) {\r\n        if('time' != metric.columns[0].type) {\r\n          throw 'Expected a time column from the table format';\r\n        }\r\n\r\n        var last = null;\r\n        for(var i=1; i<metric.columns.length; i++) {\r\n          var res = new DistinctPoints(metric.columns[i].text);\r\n          for(var j=0; j<metric.rows.length; j++) {\r\n            var row = metric.rows[j];\r\n            res.add( row[0], this.formatValue( row[i] ) );\r\n          }\r\n          res.finish( this );\r\n          data.push( res );\r\n        }\r\n      }\r\n      else {\r\n        var res = new DistinctPoints( metric.target );\r\n        _.forEach(metric.datapoints, (point) => {\r\n          res.add( point[1], this.formatValue(point[0]) );\r\n        });\r\n        res.finish( this );\r\n        data.push( res );\r\n      }\r\n    });\r\n    this.data = data;\r\n\r\n    this.onRender();\r\n\r\n    //console.log( 'data', dataList, this.data);\r\n  }\r\n\r\n  removeColorMap(map) {\r\n    var index = _.indexOf(this.panel.colorMaps, map);\r\n    this.panel.colorMaps.splice(index, 1);\r\n    this.updateColorInfo();\r\n  };\r\n\r\n  updateColorInfo() {\r\n    var cm = {};\r\n    for(var i=0; i<this.panel.colorMaps.length; i++) {\r\n      var m = this.panel.colorMaps[i];\r\n      if(m.text) {\r\n        cm[m.text] = m.color;\r\n      }\r\n    }\r\n    this.colorMap = cm;\r\n    this.render();\r\n  }\r\n\r\n  addColorMap(what) {\r\n    if(what == 'curent') {\r\n      _.forEach(this.data, (metric) => {\r\n        if(metric.legendInfo) {\r\n          _.forEach(metric.legendInfo, (info) => {\r\n            if(!_.has(info.val)) {\r\n              this.panel.colorMaps.push({text: info.val, color: this.getColor(info.val) });\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n    else {\r\n      this.panel.colorMaps.push({text: '???', color: this.randomColor() });\r\n    }\r\n    this.updateColorInfo();\r\n  }\r\n\r\n  removeValueMap(map) {\r\n    var index = _.indexOf(this.panel.valueMaps, map);\r\n    this.panel.valueMaps.splice(index, 1);\r\n    this.render();\r\n  };\r\n\r\n  addValueMap() {\r\n    this.panel.valueMaps.push({value: '', op: '=', text: '' });\r\n  }\r\n\r\n  removeRangeMap(rangeMap) {\r\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\r\n    this.panel.rangeMaps.splice(index, 1);\r\n    this.render();\r\n  };\r\n\r\n  addRangeMap() {\r\n    this.panel.rangeMaps.push({from: '', to: '', text: ''});\r\n  }\r\n\r\n  onConfigChanged() {\r\n    //console.log( \"Config changed...\");\r\n    this.isTimeline = true; //this.panel.display == 'timeline';\r\n    this.render();\r\n  }\r\n\r\n  getLegendDisplay(info, metric) {\r\n    var disp = info.val;\r\n    if(this.panel.showLegendPercent || this.panel.showLegendCounts || this.panel.showLegendTime) {\r\n      disp += \" (\";\r\n      var hassomething = false;\r\n      if(this.panel.showLegendTime) {\r\n        disp += moment.duration(info.ms).humanize();\r\n        hassomething = true;\r\n      }\r\n\r\n      if(this.panel.showLegendPercent) {\r\n        if(hassomething) {\r\n          disp += \", \";\r\n        }\r\n\r\n        var dec = this.panel.legendPercentDecimals;\r\n        if(_.isNil(dec)) {\r\n          if(info.per>.98 && metric.changes.length>1) {\r\n            dec = 2;\r\n          }\r\n          else if(info.per<0.02) {\r\n            dec = 2;\r\n          }\r\n          else {\r\n            dec = 0;\r\n          }\r\n        }\r\n        disp += kbn.valueFormats.percentunit(info.per, dec);\r\n        hassomething = true;\r\n      }\r\n\r\n      if(this.panel.showLegendCounts) {\r\n        if(hassomething) {\r\n          disp += \", \";\r\n        }\r\n        disp += info.count+\"x\";\r\n      }\r\n      disp += \")\";\r\n    }\r\n    return disp;\r\n  }\r\n\r\n  //------------------\r\n  // Mouse Events\r\n  //------------------\r\n\r\n  showTooltip(evt, point, isExternal) {\r\n    var from = point.start;\r\n    var to = point.start + point.ms;\r\n    var time = point.ms;\r\n    var val = point.val;\r\n\r\n    if(this.mouse.down != null) {\r\n      from = Math.min(this.mouse.down.ts, this.mouse.position.ts);\r\n      to   = Math.max(this.mouse.down.ts, this.mouse.position.ts);\r\n      time = to - from;\r\n      val = \"Zoom To:\";\r\n    }\r\n\r\n    var body = '<div class=\"graph-tooltip-time\">'+ val + '</div>';\r\n\r\n    body += \"<center>\"\r\n    body += this.dashboard.formatDate( moment(from) ) + \"<br/>\";\r\n    body += \"to<br/>\";\r\n    body += this.dashboard.formatDate( moment(to) ) + \"<br/><br/>\";\r\n    body += moment.duration(time).humanize() + \"<br/>\";\r\n    body += \"</center>\"\r\n\r\n    var pageX = 0;\r\n    var pageY = 0;\r\n    if(isExternal) {\r\n      var rect = this.canvas.getBoundingClientRect();\r\n      pageY = rect.top + (evt.pos.panelRelY * rect.height);\r\n      if(pageY < 0 || pageY > $(window).innerHeight()) {\r\n        // Skip Hidden tooltip\r\n        this.$tooltip.detach();\r\n        return;\r\n      }\r\n      pageY += $(window).scrollTop();\r\n\r\n      var elapsed = this.range.to - this.range.from;\r\n      var pX = (evt.pos.x - this.range.from) / elapsed;\r\n      pageX = rect.left + (pX * rect.width);\r\n    }\r\n    else {\r\n      pageX = evt.evt.pageX;\r\n      pageY = evt.evt.pageY;\r\n    }\r\n\r\n    this.$tooltip.html(body).place_tt(pageX + 20, pageY + 5);\r\n  };\r\n\r\n  onGraphHover(evt, showTT, isExternal) {\r\n    this.externalPT = false;\r\n    if(this.data && this.data.length) {\r\n      var hover = null;\r\n      var j = Math.floor(this.mouse.position.y/this.panel.rowHeight);\r\n      if (j < 0) {\r\n        j = 0;\r\n      }\r\n      if (j >= this.data.length) {\r\n        j = this.data.length-1;\r\n      }\r\n\r\n      if(this.isTimeline) {\r\n        hover = this.data[j].changes[0];\r\n        for(var i=0; i<this.data[j].changes.length; i++) {\r\n          if(this.data[j].changes[i].start > this.mouse.position.ts) {\r\n            break;\r\n          }\r\n          hover = this.data[j].changes[i];\r\n        }\r\n        this.hoverPoint = hover;\r\n\r\n        if(showTT) {\r\n          this.externalPT = isExternal;\r\n          this.showTooltip( evt, hover, isExternal );\r\n        }\r\n        this.onRender(); // refresh the view\r\n      }\r\n      else if(!isExternal) {\r\n        if(this.panel.display == 'stacked') {\r\n          hover = this.data[j].legendInfo[0];\r\n          for(var i=0; i<this.data[j].legendInfo.length; i++) {\r\n            if(this.data[j].legendInfo[i].x > this.mouse.position.x) {\r\n              break;\r\n            }\r\n            hover = this.data[j].legendInfo[i];\r\n          }\r\n          this.hoverPoint = hover;\r\n          this.onRender(); // refresh the view\r\n\r\n          if(showTT) {\r\n            this.externalPT = isExternal;\r\n            this.showLegandTooltip(evt.evt, hover);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      this.$tooltip.detach(); // make sure it is hidden\r\n    }\r\n  }\r\n\r\n  onMouseClicked(where) {\r\n    var pt = this.hoverPoint;\r\n    if(pt && pt.start) {\r\n      var range = {from: moment.utc(pt.start), to: moment.utc(pt.start+pt.ms) };\r\n      this.timeSrv.setTime(range);\r\n      this.clear();\r\n    }\r\n  }\r\n\r\n  onMouseSelectedRange(range) {\r\n    this.timeSrv.setTime(range);\r\n    this.clear();\r\n  }\r\n\r\n  clear() {\r\n    this.mouse.position = null;\r\n    this.mouse.down = null;\r\n    this.hoverPoint = null;\r\n    $(this.canvas).css( 'cursor', 'wait' );\r\n    appEvents.emit('graph-hover-clear');\r\n    this.render();\r\n  }\r\n}\r\nDiscretePanelCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n  DiscretePanelCtrl as PanelCtrl\r\n};\r\n\r\n\r\n"]}